<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tarik Tunai â€“ BANK RISMA</title>

  <link rel="stylesheet" href="/style.css" />

  <!-- DATA -->
  <script src="/anggota.js"></script>
  <script src="/rismafarm.js"></script>
  <script src="/umi.js"></script>
  <script src="/umi2.js"></script>
  <script src="/tariktunai.js"></script>
  <script src="/bank-risma.js"></script>

  <!-- NAV -->
  <script src="/navbar2.js"></script>
</head>

<body>
<script>renderNavbar("tarik", "admin")</script>

<main class="container">
  <h1>ğŸ’¸ Tarik Tunai Anggota</h1>
  <small>Input penarikan bonus panen anggota</small>

  <section class="card section">
    <label>Tanggal Penarikan</label>
    <input type="date" id="tanggal" />

    <label>Daftar Anggota</label>
    <div id="listAnggota" class="note"></div>

    <label>
      <input type="checkbox" id="ambilSemua" />
      Ambil seluruh saldo bonus
    </label>
    <small>Jika dicentang, sistem akan mengambil sisa saldo masing-masing anggota</small>

    <label>Nominal Manual</label>
    <input type="number" id="jumlah" placeholder="Isi jika tidak ambil semua" />

    <button onclick="generateTarik()">Generate Data Tarik Tunai</button>
  </section>

  <section class="card section">
    <h3>Hasil (salin ke <code>tariktunai.js</code>)</h3>
    <pre id="output">// hasil akan muncul di sini</pre>
    <button class="outline" onclick="salinHasil()">ğŸ“‹ Salin</button>
    <small>âš ï¸ Tempelkan di BARIS PALING ATAS array <code>tarikTunai</code></small>
  </section>
</main>

<script>
const saldoMap = {};
BANK_RISMA_DATA.tabelAnggota.forEach(a => saldoMap[a.nama] = a.saldo);

// checklist anggota
const list = document.getElementById("listAnggota");
anggota.forEach(nama => {
  list.innerHTML += `
    <label>
      <input type="checkbox" value="${nama}">
      ${nama} â€” Saldo: ${saldoMap[nama].toLocaleString("id-ID")}
    </label><br>
  `;
});

function generateTarik() {
  const tanggal = document.getElementById("tanggal").value;
  const ambilAll = document.getElementById("ambilSemua").checked;
  const manual = Number(document.getElementById("jumlah").value || 0);

  if (!tanggal) return alert("Tanggal wajib diisi");

  let hasil = "";

  document.querySelectorAll("#listAnggota input:checked").forEach(cb => {
    const nama = cb.value;
    const jumlah = ambilAll ? saldoMap[nama] : manual;
    if (!jumlah || jumlah <= 0) return;

    hasil += `{
  tanggal: "${tanggal}",
  nama: "${nama}",
  jumlah: ${jumlah}
},
`;
  });

  document.getElementById("output").textContent =
    hasil || "// âŒ Tidak ada data valid";
}

function salinHasil() {
  const teks = document.getElementById("output").textContent;
  if (!teks || teks.includes("âŒ")) return;
  navigator.clipboard.writeText(teks).then(() => alert("Berhasil disalin"));
}
</script>
</body>
</html>